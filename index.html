<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthAssist - Medical AI Chatbot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 90%;
            max-width: 800px;
            height: 90vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }

        .chat-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .bot-avatar {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }

        .bot-info h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .bot-status {
            font-size: 14px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .header-controls {
            display: flex;
            gap: 15px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
        }

        .message.bot .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-left-radius: 5px;
        }

        .message.user .message-content {
            background: #4facfe;
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-size: 18px;
        }

        .message.bot .message-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .message.user .message-avatar {
            background: #4facfe;
            color: white;
        }

        .typing-indicator {
            display: none;
            padding: 15px 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 20px;
            margin: 10px 0;
            max-width: 70%;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .chat-input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #eee;
        }

        .input-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 10px 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .input-container:focus-within {
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .chat-input {
            flex: 1;
            border: none;
            outline: none;
            padding: 10px 0;
            font-size: 16px;
            background: transparent;
            color: #333;
        }

        .chat-input::placeholder {
            color: #888;
        }

        .voice-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .voice-btn:hover {
            transform: scale(1.1);
        }

        .voice-btn.listening {
            animation: voicePulse 1s infinite;
        }

        @keyframes voicePulse {
            0% { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); }
            50% { background: linear-gradient(135deg, #ff4757 0%, #ff3838 100%); }
            100% { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%); }
        }

        .send-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            color: white;
            padding: 12px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: scale(1.05);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.3);
            color: #4facfe;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .quick-action-btn:hover {
            background: rgba(79, 172, 254, 0.2);
            transform: translateY(-2px);
        }

        .language-selector {
            position: relative;
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            min-width: 120px;
            display: none;
            z-index: 1000;
        }

        .language-dropdown.show {
            display: block;
        }

        .language-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.2s;
            color: #333;
        }

        .language-option:hover {
            background: #f5f5f5;
        }

        .welcome-message {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .welcome-icon {
            font-size: 48px;
            color: #4facfe;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .chat-container {
                width: 95%;
                height: 95vh;
                border-radius: 15px;
            }
            
            .header-controls {
                gap: 10px;
            }
            
            .control-btn {
                padding: 8px;
                font-size: 14px;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .quick-actions {
                gap: 8px;
            }
            
            .quick-action-btn {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-left">
                <div class="bot-avatar">
                    <i class="fas fa-user-md"></i>
                </div>
                <div class="bot-info">
                    <h1>HealthAssist AI</h1>
                    <div class="bot-status">
                        <div class="status-dot"></div>
                        <span id="statusText">Online & Ready to Help</span>
                    </div>
                </div>
            </div>
            <div class="header-controls">
                <div class="language-selector">
                    <button class="control-btn" id="languageBtn">
                        <i class="fas fa-globe"></i>
                    </button>
                    <div class="language-dropdown" id="languageDropdown">
                        <div class="language-option" data-lang="en">English</div>
                        <div class="language-option" data-lang="hi">हिंदी</div>
                        <div class="language-option" data-lang="te">తెలుగు</div>
                        <div class="language-option" data-lang="ta">தமிழ்</div>
                    </div>
                </div>
                <button class="control-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <div class="welcome-icon">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <h2>Welcome to HealthAssist AI</h2>
                <p>Your trusted medical companion for preventive healthcare, symptom information, and vaccination schedules.</p>
                <p style="margin-top: 10px; color: #888;">Ask me anything about health, symptoms, or preventive care!</p>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <div class="chat-input-area">
            <div class="quick-actions">
                <button class="quick-action-btn" data-action="symptoms">Common Symptoms</button>
                <button class="quick-action-btn" data-action="prevention">Preventive Care</button>
                <button class="quick-action-btn" data-action="vaccination">Vaccination Schedule</button>
                <button class="quick-action-btn" data-action="emergency">Emergency Info</button>
            </div>
            <div class="input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask me about health, symptoms, or preventive care...">
                <button class="voice-btn" id="voiceBtn">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="send-btn" id="sendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        class HealthAssistChatbot {
            constructor() {
                this.messages = [];
                this.currentLanguage = 'en';
                this.isListening = false;
                this.isTyping = false;
                this.recognition = null;
                
                this.initializeElements();
                this.bindEvents();
                this.initializeSpeechRecognition();
                this.addWelcomeMessage();
            }

            initializeElements() {
                this.chatMessages = document.getElementById('chatMessages');
                this.chatInput = document.getElementById('chatInput');
                this.sendBtn = document.getElementById('sendBtn');
                this.voiceBtn = document.getElementById('voiceBtn');
                this.languageBtn = document.getElementById('languageBtn');
                this.languageDropdown = document.getElementById('languageDropdown');
                this.typingIndicator = document.getElementById('typingIndicator');
                this.statusText = document.getElementById('statusText');
            }

            bindEvents() {
                this.sendBtn.addEventListener('click', () => this.sendMessage());
                this.chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                
                this.voiceBtn.addEventListener('click', () => this.toggleVoiceRecognition());
                this.languageBtn.addEventListener('click', () => this.toggleLanguageDropdown());
                
                // Quick action buttons
                document.querySelectorAll('.quick-action-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const action = btn.dataset.action;
                        this.handleQuickAction(action);
                    });
                });

                // Language selection
                document.querySelectorAll('.language-option').forEach(option => {
                    option.addEventListener('click', () => {
                        this.changeLanguage(option.dataset.lang);
                    });
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!this.languageBtn.contains(e.target) && !this.languageDropdown.contains(e.target)) {
                        this.languageDropdown.classList.remove('show');
                    }
                });
            }

            initializeSpeechRecognition() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new webkitSpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onstart = () => {
                        this.isListening = true;
                        this.voiceBtn.classList.add('listening');
                        this.statusText.textContent = 'Listening...';
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.chatInput.value = transcript;
                        this.sendMessage();
                    };

                    this.recognition.onend = () => {
                        this.isListening = false;
                        this.voiceBtn.classList.remove('listening');
                        this.statusText.textContent = 'Online & Ready to Help';
                    };

                    this.recognition.onerror = () => {
                        this.isListening = false;
                        this.voiceBtn.classList.remove('listening');
                        this.statusText.textContent = 'Voice recognition error';
                        setTimeout(() => {
                            this.statusText.textContent = 'Online & Ready to Help';
                        }, 2000);
                    };
                }
            }

            addWelcomeMessage() {
                // Remove the welcome message div and add actual chat message
                setTimeout(() => {
                    const welcomeDiv = document.querySelector('.welcome-message');
                    if (welcomeDiv) welcomeDiv.remove();
                    
                    const welcomeText = this.getWelcomeMessage();
                    this.addMessage('bot', welcomeText);
                }, 1000);
            }

            getWelcomeMessage() {
                const messages = {
                    'en': `🏥 **Welcome to HealthAssist AI!**

I'm your intelligent medical companion designed for rural and semi-urban healthcare support.

**🩺 I can help you with:**
• Disease symptoms and prevention
• Vaccination schedules for all ages
• Health tips and home remedies  
• Emergency first aid guidance
• Mental health support
• Government health schemes info

**🎤 Features:**
• Voice recognition - click 🎤 to speak
• Multiple Indian languages
• Emergency detection system
• Professional medical guidance

**⚠️ Important:** I provide general health information, not medical diagnosis. Always consult healthcare providers for serious concerns.

**🚨 Emergency? Call 108 immediately!**

How can I help you today?`,

                    'hi': `🏥 **HealthAssist AI में आपका स्वागत है!**

मैं ग्रामीण और अर्ध-शहरी स्वास्थ्य सेवा सहायता के लिए आपका बुद्धिमान चिकित्सा साथी हूं।

**🩺 मैं आपकी मदद कर सकता हूं:**
• रोग के लक्षण और रोकथाम
• सभी उम्र के लिए टीकाकरण कार्यक्रम
• स्वास्थ्य सुझाव और घरेलू उपचार
• आपातकालीन प्राथमिक चिकित्सा मार्गदर्शन
• मानसिक स्वास्थ्य सहायता

**⚠️ महत्वपूर्ण:** मैं सामान्य स्वास्थ्य जानकारी प्रदान करता हूं, चिकित्सा निदान नहीं।

आज मैं आपकी कैसे मदद कर सकता हूं?`
                };
                
                return messages[this.currentLanguage] || messages['en'];
            }

            speakResponse(text) {
                // Text-to-speech functionality
                if ('speechSynthesis' in window) {
                    try {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = this.getVoiceLanguage();
                        utterance.rate = 0.9;
                        utterance.pitch = 1;
                        utterance.volume = 0.8;
                        
                        // Only speak if text is not too long (to avoid overwhelming)
                        if (text.length < 300) {
                            speechSynthesis.speak(utterance);
                        }
                    } catch (error) {
                        console.log('Text-to-speech not available');
                    }
                }
            }

            getVoiceLanguage() {
                const voiceMap = {
                    'en': 'en-US',
                    'hi': 'hi-IN',
                    'mr': 'mr-IN', 
                    'kn': 'kn-IN',
                    'te': 'te-IN',
                    'ta': 'ta-IN'
                };
                return voiceMap[this.currentLanguage] || 'en-US';
            }

            sendMessage() {
                const message = this.chatInput.value.trim();
                if (!message || this.isTyping) return;

                this.addMessage('user', message);
                this.chatInput.value = '';
                this.showTypingIndicator();
                
                // Call backend API
                this.generateResponse(message);
            }

            addMessage(sender, text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                
                const avatar = document.createElement('div');
                avatar.className = 'message-avatar';
                avatar.innerHTML = sender === 'bot' ? '<i class="fas fa-user-md"></i>' : '<i class="fas fa-user"></i>';
                
                const content = document.createElement('div');
                content.className = 'message-content';
                content.textContent = text;
                
                if (sender === 'bot') {
                    messageDiv.appendChild(avatar);
                    messageDiv.appendChild(content);
                } else {
                    messageDiv.appendChild(content);
                    messageDiv.appendChild(avatar);
                }
                
                this.chatMessages.appendChild(messageDiv);
                this.scrollToBottom();
                this.messages.push({ sender, text, timestamp: new Date() });
            }

            showTypingIndicator() {
                this.isTyping = true;
                this.typingIndicator.style.display = 'block';
                this.statusText.textContent = 'AI is thinking...';
                this.scrollToBottom();
            }

            hideTypingIndicator() {
                this.isTyping = false;
                this.typingIndicator.style.display = 'none';
                this.statusText.textContent = 'Online & Ready to Help';
            }

            async generateResponse(userMessage) {
                // Smart local medical AI - works without backend!
                this.hideTypingIndicator();
                const response = this.getSmartLocalResponse(userMessage);
                this.addMessage('bot', response);
                
                // Check for emergencies locally
                if (this.detectEmergency(userMessage)) {
                    setTimeout(() => this.showEmergencyAlert(), 1000);
                }
                
                // Try to speak the response if text-to-speech is available
                this.speakResponse(response);
            }

            getSmartLocalResponse(userMessage) {
                const msg = userMessage.toLowerCase();
                
                // Emergency responses
                if (this.detectEmergency(userMessage)) {
                    return `🚨 **MEDICAL EMERGENCY PROTOCOL**

**IMMEDIATE ACTION REQUIRED:**
📞 **Call 108 RIGHT NOW** (National Ambulance)

**While waiting for help:**
• Stay calm and don't panic
• If conscious, keep patient sitting upright
• Loosen tight clothing
• Don't give food or water
• Monitor breathing and pulse
• Be ready to give location to ambulance

**Other Emergency Numbers:**
• Police: 100
• Fire: 101
• Women Helpline: 181
• Poison Control: 1066

⚠️ **Time is critical in emergencies. Call 108 immediately!**`;
                }
                
                // Fever and temperature
                if (msg.includes('fever') || msg.includes('temperature') || msg.includes('बुखार') || msg.includes('జ్వరం')) {
                    return `🌡️ **FEVER MANAGEMENT GUIDE**

**Immediate Steps:**
• Measure temperature with thermometer
• Rest in cool, ventilated room
• Drink plenty of fluids (water, ORS, coconut water)
• Use damp cloth on forehead
• Wear light cotton clothes

**Medication:**
• Paracetamol 500mg every 6-8 hours (adults)
• Children: Consult dosage chart or doctor

**See Doctor If:**
• Fever above 103°F (39.4°C)
• Fever for more than 3 days
• Severe headache or vomiting
• Difficulty breathing
• Rash or severe body pain

**Emergency: Call 108 if fever + difficulty breathing**

💊 **Avoid aspirin for children under 18**`;
                }
                
                // Cough and cold
                if (msg.includes('cough') || msg.includes('cold') || msg.includes('खांसी') || msg.includes('దగ్గు')) {
                    return `😷 **COUGH & COLD TREATMENT**

**Home Remedies:**
• Warm ginger-honey tea (3-4 times daily)
• Steam inhalation (5-10 minutes)
• Salt water gargling (warm water + 1 tsp salt)
• Turmeric milk before bed
• Stay hydrated (warm liquids preferred)

**Rest & Care:**
• Get adequate sleep (7-8 hours)
• Avoid cold foods and drinks
• Use humidifier or keep bowl of water in room
• Cover mouth while coughing

**See Doctor If:**
• Cough with blood or thick yellow/green phlegm
• High fever with cough
• Breathing difficulty
• Chest pain
• Symptoms worsen after 7 days

**For Children:** Extra care needed, consult pediatrician sooner

💡 **Prevention:** Wash hands frequently, avoid crowded places`;
                }
                
                // Vaccination queries
                if (msg.includes('vaccination') || msg.includes('vaccine') || msg.includes('टीका') || msg.includes('వ్యాక్సిన్')) {
                    return `💉 **COMPLETE VACCINATION GUIDE**

**🧒 CHILDREN (Birth to 18 years):**
• **Birth:** BCG, Hepatitis B
• **6 weeks:** DPT-1, Polio-1, Hepatitis B-2
• **10 weeks:** DPT-2, Polio-2
• **14 weeks:** DPT-3, Polio-3, Hepatitis B-3
• **9-12 months:** MMR (Measles, Mumps, Rubella)
• **16-24 months:** DPT booster, Polio booster
• **5-6 years:** DPT booster
• **10 years:** TT (Tetanus)
• **16 years:** TT booster

**👨‍👩‍👧‍👦 ADULTS:**
• **Tetanus:** Every 10 years
• **Influenza:** Annual (especially 65+ age)
• **COVID-19:** As per government guidelines
• **Hepatitis B:** If at risk

**🤰 PREGNANT WOMEN:**
• **TT-1:** Early pregnancy
• **TT-2:** 4 weeks after TT-1

**📍 Where to get vaccinated:**
• Primary Health Centers (PHCs)
• Government hospitals
• Anganwadi centers
• Private clinics (paid)

**💰 Cost:** Most vaccines FREE at government centers

📞 **For more info:** Call 104 (Health Helpline)`;
                }
                
                // Preventive healthcare
                if (msg.includes('prevention') || msg.includes('healthy') || msg.includes('स्वास्थ्य') || msg.includes('ఆరోగ్యం')) {
                    return `🛡️ **PREVENTIVE HEALTHCARE GUIDE**

**🧼 Daily Hygiene:**
• Wash hands with soap (20+ seconds)
• Brush teeth twice daily
• Bath daily with clean water
• Keep nails short and clean
• Wear clean clothes

**🥗 Nutrition:**
• Eat variety: grains, vegetables, fruits, proteins
• Include green leafy vegetables daily
• Drink 8-10 glasses clean water
• Avoid excessive oil, sugar, salt
• Eat home-cooked meals when possible

**🏃‍♂️ Physical Activity:**
• Walk 30 minutes daily
• Exercise or yoga 3-4 times/week
• Avoid sitting for long periods
• Play outdoor games (children)

**😴 Rest & Mental Health:**
• Sleep 7-8 hours daily
• Avoid stress, practice meditation
• Maintain social connections
• Seek help if feeling depressed

**🏥 Regular Checkups:**
• Annual health screening
• Blood pressure, diabetes check
• Eye and dental checkups
• Women: Regular cancer screening

**🚫 Avoid:**
• Smoking and tobacco
• Excessive alcohol
• Junk food
• Unprotected water sources

**💡 Remember: Prevention is better than cure!**`;
                }
                
                // Pain and headache
                if (msg.includes('headache') || msg.includes('pain') || msg.includes('दर्द') || msg.includes('నొప్పి')) {
                    return `🤕 **HEADACHE & PAIN RELIEF**

**🏠 Immediate Relief:**
• Rest in quiet, dark room
• Apply cold compress on forehead (15 minutes)
• Gentle head and neck massage
• Stay hydrated - drink water slowly
• Avoid bright lights and loud sounds

**💊 Medication:**
• Paracetamol 500mg (adults) - max 4 times/day
• Don't exceed recommended dose
• Take with food to avoid stomach upset

**⚠️ See Doctor Immediately If:**
• Sudden severe headache (worst ever)
• Headache with fever and stiff neck
• Headache with vision changes
• After head injury
• Frequent recurring headaches

**🧘‍♀️ Prevention:**
• Regular sleep schedule
• Manage stress
• Stay hydrated
• Limit screen time
• Exercise regularly

**📞 Emergency:** If headache with confusion, vomiting, or loss of consciousness - Call 108

**Natural Remedies:**
• Ginger tea
• Peppermint oil (temples)
• Adequate rest`;
                }
                
                // Mental health
                if (msg.includes('depression') || msg.includes('anxiety') || msg.includes('stress') || msg.includes('चिंता') || msg.includes('ఒత్తిడి')) {
                    return `🧠 **MENTAL HEALTH SUPPORT**

**🤗 You're Not Alone:**
Mental health is as important as physical health. Seeking help shows strength, not weakness.

**Immediate Self-Care:**
• Take deep breaths (4-7-8 technique)
• Talk to someone you trust
• Go for a walk in nature
• Listen to calming music
• Practice gratitude

**🧘‍♀️ Daily Practices:**
• Meditation (even 5 minutes helps)
• Regular exercise
• Maintain sleep routine
• Limit social media
• Connect with friends/family

**📞 Professional Help:**
• **National Mental Health Helpline: 1075**
• **KIRAN Helpline: 1800-599-0019**
• **iCall: 9152987821**
• Visit nearest mental health professional

**🚨 Crisis Support:**
If having thoughts of self-harm:
• Call 1075 immediately
• Go to nearest hospital
• Don't stay alone

**Remember:** Mental health conditions are treatable. Recovery is possible with proper support and treatment.

**Free Government Services:**
• District Mental Health Program
• NIMHANS helpline
• Community health workers`;
                }
                
                // Default intelligent medical response based on context
                if (msg.includes('hello') || msg.includes('hi') || msg.includes('नमस्ते') || msg.includes('హలో')) {
                    return `👋 **Hello! I'm HealthAssist AI**

I'm here to help you with medical information and health guidance.

**🔍 Popular topics I can help with:**
• "I have fever" - Fever management
• "Vaccination schedule" - Complete immunization info  
• "Emergency help" - First aid guidance
• "Preventive care" - Health tips
• "Mental health" - Psychological support

**🎤 Tip:** Click the microphone button to speak your questions!

What health topic would you like to learn about?`;
                }
                
                return `👩‍⚕️ **HealthAssist AI - Medical Information**

I understand you're seeking health information. Here's how I can help:

**🩺 Ask me about:**
• **Symptoms:** "I have fever/cough/headache/stomach pain"
• **Prevention:** "How to stay healthy/prevent diseases"
• **Vaccination:** "When should children get vaccinated"
• **Emergency:** "What to do in medical emergency"
• **Mental Health:** "I feel stressed/anxious/depressed"

**🏥 Quick Emergency Access:**
• **Ambulance:** 108
• **Health Helpline:** 104  
• **Mental Health:** 1075
• **Poison Control:** 1066

**💡 Try asking specific questions like:**
- "My child has fever, what should I do?"
- "When to get COVID vaccine?"
- "How to prevent diabetes?"
- "First aid for cuts and wounds"

**⚠️ Important:** This is general health information, not medical diagnosis. Always consult qualified healthcare providers for serious concerns.

**🌟 Available in:** English, Hindi, Marathi, Kannada, Telugu, Tamil

How can I help you with your health today?`;
            }

            detectEmergency(message) {
                const emergencyKeywords = [
                    'emergency', 'urgent', 'severe', 'critical', 'chest pain', 'heart attack', 
                    'difficulty breathing', 'unconscious', 'bleeding', 'accident', 'poison',
                    'suicide', 'overdose', 'stroke', 'seizure', 'allergic reaction',
                    'आपातकाल', 'गंभीर', 'सांस लेने में कठिनाई', 'दिल का दौरा',
                    'అత్యవసర', 'తీవ్రమైన', 'గుండె నొప్పి', 'ఊపిరి ఆడకపోవడం'
                ];
                
                return emergencyKeywords.some(keyword => 
                    message.toLowerCase().includes(keyword.toLowerCase())
                );
            }

            getUserId() {
                // Generate or retrieve user ID (using sessionStorage since localStorage might not work)
                let userId = sessionStorage.getItem('healthassist_user_id');
                if (!userId) {
                    userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    try {
                        sessionStorage.setItem('healthassist_user_id', userId);
                    } catch (e) {
                        // If storage fails, just use the generated ID for this session
                        console.log('Storage not available, using temporary user ID');
                    }
                }
                return userId;
            }

            playAudioResponse(audioBase64) {
                try {
                    const audio = new Audio('data:audio/mp3;base64,' + audioBase64);
                    audio.play().catch(e => console.log('Audio play failed:', e));
                } catch (error) {
                    console.log('Audio processing failed:', error);
                }
            }

            showEmergencyAlert() {
                // Create emergency overlay
                const emergencyDiv = document.createElement('div');
                emergencyDiv.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 0, 0, 0.9);
                    color: white;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    font-size: 24px;
                    text-align: center;
                `;
                
                emergencyDiv.innerHTML = `
                    <div style="animation: pulse 1s infinite;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h2>MEDICAL EMERGENCY DETECTED</h2>
                        <p style="font-size: 18px; margin: 20px;">Call Emergency Services Immediately</p>
                        <div style="font-size: 32px; margin: 20px;">📞 108</div>
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            background: white;
                            color: red;
                            border: none;
                            padding: 15px 30px;
                            border-radius: 10px;
                            font-size: 16px;
                            cursor: pointer;
                            margin-top: 20px;
                        ">I've Called for Help</button>
                    </div>
                `;
                
                document.body.appendChild(emergencyDiv);
                
                // Auto-remove after 10 seconds
                setTimeout(() => {
                    if (emergencyDiv.parentElement) {
                        emergencyDiv.remove();
                    }
                }, 10000);
            }

            handleQuickAction(action) {
                const actions = {
                    symptoms: "What are the common symptoms I should watch out for?",
                    prevention: "Tell me about preventive healthcare measures",
                    vaccination: "What are the important vaccinations I need?",
                    emergency: "What should I do in a medical emergency?"
                };
                
                if (actions[action]) {
                    this.chatInput.value = actions[action];
                    this.sendMessage();
                }
            }

            async toggleVoiceRecognition() {
                if (this.isListening) {
                    this.stopVoiceRecognition();
                    return;
                }

                // Check if browser supports speech recognition
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                if (!SpeechRecognition) {
                    alert('🎤 Voice recognition not supported in your browser. Please use Chrome, Edge, or Safari.');
                    return;
                }

                try {
                    if (!this.recognition) {
                        this.recognition = new SpeechRecognition();
                        this.recognition.continuous = false;
                        this.recognition.interimResults = false;
                        
                        // Set language based on current selection
                        const langMap = {
                            'en': 'en-US',
                            'hi': 'hi-IN',
                            'mr': 'mr-IN',
                            'kn': 'kn-IN',
                            'te': 'te-IN',
                            'ta': 'ta-IN'
                        };
                        this.recognition.lang = langMap[this.currentLanguage] || 'en-US';

                        this.recognition.onstart = () => {
                            this.isListening = true;
                            this.voiceBtn.classList.add('listening');
                            this.voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                            this.statusText.textContent = 'Listening... (Click to stop)';
                        };

                        this.recognition.onresult = (event) => {
                            const transcript = event.results[0][0].transcript;
                            this.chatInput.value = transcript;
                            this.statusText.textContent = 'Speech recognized! Sending message...';
                            setTimeout(() => this.sendMessage(), 500);
                        };

                        this.recognition.onend = () => {
                            this.stopVoiceRecognition();
                        };

                        this.recognition.onerror = (event) => {
                            console.error('Speech recognition error:', event.error);
                            this.stopVoiceRecognition();
                            
                            const errorMessages = {
                                'not-allowed': 'Microphone access denied. Please allow microphone access and try again.',
                                'no-speech': 'No speech detected. Please try again and speak clearly.',
                                'network': 'Network error. Please check your internet connection.',
                                'audio-capture': 'Microphone not found. Please check your microphone connection.'
                            };
                            
                            const errorMsg = errorMessages[event.error] || 'Speech recognition failed. Please try again.';
                            this.statusText.textContent = errorMsg;
                            
                            setTimeout(() => {
                                this.statusText.textContent = 'Online & Ready to Help';
                            }, 3000);
                        };
                    }

                    // Update language if changed
                    const langMap = {
                        'en': 'en-US',
                        'hi': 'hi-IN', 
                        'mr': 'mr-IN',
                        'kn': 'kn-IN',
                        'te': 'te-IN',
                        'ta': 'ta-IN'
                    };
                    this.recognition.lang = langMap[this.currentLanguage] || 'en-US';
                    
                    this.recognition.start();

                } catch (error) {
                    console.error('Voice recognition setup error:', error);
                    alert('Unable to start voice recognition. Please check microphone permissions.');
                }
            }

            stopVoiceRecognition() {
                if (this.recognition && this.isListening) {
                    this.recognition.stop();
                }
                this.isListening = false;
                this.voiceBtn.classList.remove('listening');
                this.voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                this.statusText.textContent = 'Online & Ready to Help';
            }

            toggleLanguageDropdown() {
                this.languageDropdown.classList.toggle('show');
            }

            changeLanguage(lang) {
                this.currentLanguage = lang;
                this.languageDropdown.classList.remove('show');
                
                // Update the language display
                const langName = SUPPORTED_LANGUAGES[lang] || 'English';
                this.addMessage('bot', `🌐 Language changed to ${langName}. I'll continue to help you in your preferred language!`);
                
                // Save language preference
                try {
                    sessionStorage.setItem('healthassist_language', lang);
                } catch (e) {
                    console.log('Unable to save language preference');
                }
            }

            async checkVaccinationCenters(pincode) {
                try {
                    const response = await fetch(`http://localhost:5000/api/vaccination-centers?pincode=${pincode}`);
                    const data = await response.json();
                    
                    if (data.centers && data.centers.length > 0) {
                        let message = `💉 **Vaccination Centers near ${pincode}:**\n\n`;
                        data.centers.slice(0, 3).forEach((center, index) => {
                            message += `${index + 1}. **${center.name}**\n`;
                            message += `   📍 ${center.address}\n`;
                            message += `   💊 ${center.vaccine}\n`;
                            message += `   📅 ${center.date}\n`;
                            message += `   🎯 Available: ${center.available_capacity}\n\n`;
                        });
                        message += "📞 For booking: Visit CoWIN portal or call 1075";
                        return message;
                    } else {
                        return `No vaccination centers found for pincode ${pincode}. Please check the pincode or try nearby areas.`;
                    }
                } catch (error) {
                    return "Unable to fetch vaccination center data. Please visit CoWIN.gov.in directly.";
                }
            }

            showEmergencyAlert() {
                // Create emergency overlay with proper styling
                const emergencyDiv = document.createElement('div');
                emergencyDiv.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(135deg, rgba(255, 0, 0, 0.95), rgba(200, 0, 0, 0.95));
                    color: white;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    font-size: 24px;
                    text-align: center;
                    animation: emergencyPulse 1s infinite;
                `;
                
                emergencyDiv.innerHTML = `
                    <div style="max-width: 400px; padding: 40px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 64px; margin-bottom: 20px; animation: shake 0.5s infinite;"></i>
                        <h2 style="margin-bottom: 20px;">🚨 MEDICAL EMERGENCY DETECTED</h2>
                        <p style="font-size: 18px; margin-bottom: 20px;">Call Emergency Services Immediately</p>
                        
                        <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin: 20px 0;">
                            <div style="font-size: 36px; margin-bottom: 10px;">📞 108</div>
                            <div style="font-size: 16px;">National Ambulance Service</div>
                        </div>
                        
                        <button onclick="this.parentElement.parentElement.remove()" style="
                            background: white;
                            color: #d32f2f;
                            border: none;
                            padding: 15px 30px;
                            border-radius: 25px;
                            font-size: 16px;
                            cursor: pointer;
                            margin-top: 20px;
                            font-weight: bold;
                            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                        ">✓ I've Called for Help</button>
                    </div>
                `;
                
                // Add emergency animation styles
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes emergencyPulse {
                        0% { background: linear-gradient(135deg, rgba(255, 0, 0, 0.95), rgba(200, 0, 0, 0.95)); }
                        50% { background: linear-gradient(135deg, rgba(255, 50, 50, 0.95), rgba(220, 20, 20, 0.95)); }
                        100% { background: linear-gradient(135deg, rgba(255, 0, 0, 0.95), rgba(200, 0, 0, 0.95)); }
                    }
                    @keyframes shake {
                        0%, 100% { transform: translateX(0); }
                        25% { transform: translateX(-5px); }
                        75% { transform: translateX(5px); }
                    }
                `;
                document.head.appendChild(style);
                
                document.body.appendChild(emergencyDiv);
                
                // Auto-remove after 15 seconds
                setTimeout(() => {
                    if (emergencyDiv.parentElement) {
                        emergencyDiv.remove();
                        style.remove();
                    }
                }, 15000);
            }

            scrollToBottom() {
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
        }

        // Initialize the chatbot when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Add supported languages constant
            window.SUPPORTED_LANGUAGES = {
                'en': 'English',
                'hi': 'Hindi', 
                'mr': 'Marathi',
                'kn': 'Kannada',
                'te': 'Telugu',
                'ta': 'Tamil'
            };
            
            new HealthAssistChatbot();
        });
    </script>
</body>
</html>